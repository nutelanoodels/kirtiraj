<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Category Grid</title>
 <style>
/* =========================
   RESET & BASE
========================= */
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f9fafb;
  color: #111827;
}

/* =========================
   HEADER
========================= */
.site-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(8px);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.06);
}

.logo {
  width: 140px;
  height: auto;
}

.header-nav a {
  margin: 0 12px;
  text-decoration: none;
  color: #111827;
  font-weight: 600;
}

.header-nav a:hover {
  color: #16a34a;
}

.header-right button {
  background: #16a34a;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
}

/* =========================
   PAGE LAYOUT
========================= */
.page-wrap {
  max-width: 1200px;
  margin: auto;
}

.shop-section {
  padding: 40px 16px;
}

.section-title {
  text-align: center;
  font-size: 1.8rem;
  margin-bottom: 24px;
  font-weight: 700;
}

/* =========================
   GRID SYSTEM
========================= */
.grid {
  display: grid;
  gap: 22px;
  padding-bottom: 30px;
}

.grid.category-view {
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

.grid.item-view {
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

/* =========================
   CARDS
========================= */
.grid-item {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 18px;
  text-align: center;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.grid-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 28px rgba(0,0,0,0.08);
}

/* Category Cards */
.grid-item.category {
  font-size: 1.1rem;
  font-weight: 600;
  background: linear-gradient(135deg, #ecfdf5, #ffffff);
  border: 2px solid #a7f3d0;
  text-transform: capitalize;
}

/* Item Cards */
.grid-item.item {
  min-height: 230px;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.grid-item.item img {
  width: 100%;
  height: 110px;
  object-fit: contain;
}

/* =========================
   BACK BUTTON
========================= */
.back-btn {
  margin: 0 0 16px 8px;
  padding: 8px 16px;
  font-size: 0.95rem;
  cursor: pointer;
  background: #16a34a;
  color: white;
  border: none;
  border-radius: 10px;
  font-weight: 600;
}

.back-btn:hover {
  background: #15803d;
}

/* =========================
   MODALS
========================= */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal-box {
  background: #ffffff;
  padding: 22px;
  width: 320px;
  border-radius: 16px;
  text-align: center;
}

.modal-box img {
  width: 150px;
  height: 150px;
  object-fit: contain;
}

.hidden {
  display: none;
}

/* =========================
   QUANTITY CONTROLS
========================= */
.qty {
  display: flex;
  justify-content: center;
  gap: 14px;
  margin: 12px 0;
}

.qty button {
  padding: 6px 12px;
  font-size: 1rem;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background: #f3f4f6;
  cursor: pointer;
}

/* =========================
   CART
========================= */
.cart-item {
  display: flex;
  gap: 12px;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid #e5e7eb;
}

.cart-item img {
  width: 60px;
  height: 60px;
  object-fit: contain;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
}

.cart-info {
  flex: 1;
}

.cart-info strong {
  font-size: 0.95rem;
}

.cart-actions button {
  margin: 0 2px;
}

/* =========================
   CART MODAL
========================= */
#cartModal .modal-box {
  max-height: 80vh;
  display: flex;
  flex-direction: column;
}

.cart-items {
  overflow-y: auto;
  max-height: 50vh;
}

/* =========================
   BUTTONS
========================= */
.buy-btn {
  background: #16a34a;
  color: white;
  border: none;
  padding: 12px 18px;
  font-size: 1rem;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
}

.buy-btn:hover {
  background: #15803d;
}

/* =========================
   ABOUT & CONTACT
========================= */
.about-section,
.contact-section {
  background: #ffffff;
  padding: 40px 20px;
  margin-top: 40px;
  border-top: 1px solid #e5e7eb;
}

.about-box,
.contact-box {
  max-width: 900px;
  margin: auto;
  text-align: center;
}

.about-highlights,
.contact-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 20px;
  margin-top: 30px;
}

.about-card,
.contact-card {
  background: #f9fafb;
  padding: 20px;
  border-radius: 14px;
  border: 1px solid #e5e7eb;
}

/* =========================
   MOBILE
========================= */
@media (max-width: 480px) {
  .logo {
    width: 120px;
  }

  .section-title {
    font-size: 1.4rem;
  }

  .grid {
    gap: 16px;
  }

  .grid-item {
    padding: 14px;
  }
}
</style>
</head>
<body>
  <header class="site-header">
  <div class="header-left">
    <img src="logo2.png" alt="Kirtiraj Logo" class="logo" />
  </div>

  <nav class="header-nav">
   <a href="#categories">Shop</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>

  <div class="header-right">
    <button id="cartBtn">
      üõí Cart (<span id="cartCount">0</span>)
    </button>
  </div>
</header>
<main class="page-wrap">
  <section id="categories" class="shop-section">
  <h2 class="section-title">Shop Our Products</h2>

  <button class="back-btn" id="backBtn" style="display:none;">
    ‚Üê Back to Categories
  </button>

  <div class="grid" id="categoryGrid"></div>
</section>
</main>
  

  
<div id="productModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <img id="modalImg">
    <h3 id="modalName"></h3>
    <p id="modalPrice"></p>

    <div class="qty">
      <button onclick="changeQty(-1)">‚àí</button>
      <span id="modalQty">1</span>
      <button onclick="changeQty(1)">+</button>
    </div>

    <button onclick="addToCart()">Add to Cart</button>
  </div>
</div>
  <div id="cartModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeCart()">‚úñ</span>
    <h3>Your Cart</h3>
    <div id="cartItems" class="cart-items"></div>
    <hr>
    <div class="cart-footer">
  <strong>Total: ‚Çπ<span id="cartTotal">0</span></strong>
 <button class="buy-btn" onclick="openUserModal()">Buy Now</button>
  </div>
  </div>
</div>
<div id="userModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeUserModal()">‚úñ</span>
    <h3>Enter Your Details</h3>

    <input id="userName" type="text" placeholder="Your Name" style="width:100%;margin-bottom:10px;padding:8px;">
    <input id="userPhone" type="tel" placeholder="whatsapp Number" style="width:100%;margin-bottom:10px;padding:8px;">
    <textarea id="userAddress" placeholder="Address" style="width:100%;margin-bottom:10px;padding:8px;"></textarea>

    <button class="buy-btn" onclick="confirmOrder()">Confirm Order</button>
  </div>
</div>
<section class="about-section">
  <div class="about-box">
    <h2>About Kirtiraj</h2>

    <p>
      Kirtiraj is a family-run snacks and namkeen brand known for its
      authentic taste and traditional recipes. Every item is prepared
      with care, quality ingredients, and the same flavors that have
      been loved for generations.
    </p>

    <div class="about-highlights">
      <div class="about-card">
        <strong>üçò Traditional Recipes</strong>
        Made using time-tested methods for authentic taste.
      </div>

      <div class="about-card">
        <strong>üåø Quality Ingredients</strong>
        Fresh, hygienic, and carefully selected raw materials.
      </div>

      <div class="about-card">
        <strong>üè† Homely Taste</strong>
        Snacks that feel homemade and comforting.
      </div>

      <div class="about-card">
        <strong>üì¶ Fresh Orders</strong>
        Prepared and packed with care for every customer.
      </div>
    </div>
  </div>
</section>
<section class="contact-section">
  <div class="contact-box">
    <h2>Contact Us</h2>

    <div class="contact-grid">
      <div class="contact-card">
        <strong>üìû Phone</strong>
        +91 74859 98443
      </div>

      <div class="contact-card">
        <strong>üí¨ WhatsApp</strong>
        <a href="https://wa.me/917485998443" target="_blank">
          Chat on WhatsApp
        </a>
      </div>

      <div class="contact-card">
        <strong>üìç Address</strong>
        Kirtiraj Snacks & Namkeen<br>
        Gujarat, India
      </div>
    </div>
  </div>
</section>
<script>
    const API_BASE = "https://kirtiraj.onrender.com";
let data = {};

const categoryGrid = document.getElementById("categoryGrid");
const backBtn = document.getElementById("backBtn");

let cart = [];
let selectedItem = null;
let quantity = 1;
function openModal(item) {
  selectedItem = item;
  quantity = 1;

  document.getElementById("modalImg").src = item.img || "";
  document.getElementById("modalName").innerText = item.name;
  document.getElementById("modalPrice").innerText =
    item.rate ? `‚Çπ${item.rate}` : "Price unavailable";
  document.getElementById("modalQty").innerText = quantity;

  document.getElementById("productModal").classList.remove("hidden");
}
  

function closeModal() {
  document.getElementById("productModal").classList.add("hidden");
}

function changeQty(val) {
  quantity = Math.max(1, quantity + val);
  document.getElementById("modalQty").innerText = quantity;
}

function addToCart() {
  cart.push({
    name: selectedItem.name,
    rate: selectedItem.rate || 0,
    img: selectedItem.img || "",
    quantity
  });

  document.getElementById("cartCount").innerText = cart.length;
  closeModal();
}
async function loadProducts() {
  try {
    const response = await fetch(`${API_BASE}/api/products/`);
    const products = await response.json();

    data = {};

    products.forEach(p => {
      const category = p.category || "Others";

      if (!data[category]) {
        data[category] = [];
      }

     data[category].push({
    name: p.name,
    rate: p.price,
    img: p.image || ""
      });
    });

    showCategories();
  } catch (error) {
    console.error(error);
    alert("Failed to load products from backend");
  }
}
function showCategories() {
  categoryGrid.className = "grid category-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "none";
  if (Object.keys(data).length === 0) {
  categoryGrid.innerHTML = "<p style='text-align:center'>No products available.</p>";
}
  Object.keys(data).forEach(category => {
    const div = document.createElement("div");
    div.className = "grid-item category";
    div.textContent = category;
    div.onclick = () => showItems(category);
    categoryGrid.appendChild(div);
  });
}

function showItems(category) {
  categoryGrid.className = "grid item-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "inline";
  const items = data[category] || [];

  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "grid-item item";
    div.onclick = () => openModal(item);

    if (item.img) {
      const img = document.createElement("img");
      img.src = item.img.trim();
      img.alt = item.name;
      img.style.width = "100px";
      img.style.height = "100px";
      img.style.objectFit = "contain";
      div.appendChild(img);
    }

    const name = document.createElement("div");
    name.textContent = item.name;
    name.style.fontWeight = "bold";
    name.style.margin = "8px 0";
    name.style.textAlign = "center";

    const rate = document.createElement("div");
    rate.textContent = item.rate ? `‚Çπ${item.rate}` : "Rate Unavailable";

    div.appendChild(name);
    div.appendChild(rate);
    categoryGrid.appendChild(div);
  });
}
function openCart() {
  renderCart();
  document.getElementById("cartModal").classList.remove("hidden");
}

function closeCart() {
  document.getElementById("cartModal").classList.add("hidden");
}

function renderCart() {
  const cartItemsDiv = document.getElementById("cartItems");
  cartItemsDiv.innerHTML = "";

  let total = 0;

  if (cart.length === 0) {
    cartItemsDiv.innerText = "Your cart is empty.";
    document.getElementById("cartTotal").innerText = 0;
    return;
  }

  cart.forEach((item, index) => {
    const itemRow = document.createElement("div");
    itemRow.className = "cart-item";

    // Image
    const img = document.createElement("img");
    img.src = item.img || "";
    img.alt = item.name;

    // Info
    const info = document.createElement("div");
    info.className = "cart-info";

    const name = document.createElement("strong");
    name.textContent = item.name;

    const price = document.createElement("div");
    price.textContent = `‚Çπ${item.rate || 0} √ó ${item.quantity}`;

    info.appendChild(name);
    info.appendChild(price);

    // Actions
    const actions = document.createElement("div");
    actions.className = "cart-actions";

    const minus = document.createElement("button");
    minus.textContent = "‚àí";
    minus.onclick = () => updateQty(index, -1);

    const qty = document.createElement("span");
    qty.textContent = item.quantity;

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.onclick = () => updateQty(index, 1);

    const subtotal = document.createElement("div");
    const itemTotal = (item.rate || 0) * item.quantity;
    subtotal.textContent = `‚Çπ${itemTotal}`;
    total += itemTotal;

    const remove = document.createElement("button");
    remove.textContent = "Remove";
    remove.onclick = () => removeItem(index);

    actions.appendChild(minus);
    actions.appendChild(qty);
    actions.appendChild(plus);
    actions.appendChild(subtotal);
    actions.appendChild(remove);

    itemRow.appendChild(img);
    itemRow.appendChild(info);
    itemRow.appendChild(actions);

    cartItemsDiv.appendChild(itemRow);
  });

  document.getElementById("cartTotal").innerText = total;
}

function updateQty(index, change) {
  cart[index].quantity += change;

  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  }

  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}
function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }

  // OPTIONAL: log order
  console.log("Order placed:", cart);

  // Clear cart
  cart = [];

  // Reset UI
  document.getElementById("cartCount").innerText = 0;
  renderCart();
  closeCart();

  alert("Order placed successfully!");
}
function openUserModal() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }
  closeCart();
  document.getElementById("userModal").classList.remove("hidden");
}

function closeUserModal() {
  document.getElementById("userModal").classList.add("hidden");
}
async function confirmOrder() {
  const name = document.getElementById("userName").value.trim();
  const phone = document.getElementById("userPhone").value.trim();
  const address = document.getElementById("userAddress").value.trim();

  if (!name || !phone || !address) {
    alert("Please fill all details.");
    return;
  }

  if (cart.length === 0) {
    alert("Cart is empty.");
    return;
  }

  try {
    // 1Ô∏è‚É£ Save order in backend
    const response = await fetch(`${API_BASE}/api/orders/create/`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name,
        phone,
        address,
        items: cart, // backend already expects this
      }),
    });

    const result = await response.json();

    if (!result.success) {
      throw new Error("Order failed");
    }

    // 2Ô∏è‚É£ Build WhatsApp message (NO PRICE)
    const itemsText = cart
      .map(item => `‚Ä¢ ${item.name} √ó ${item.quantity}`)
      .join("\n");

    const message = `
New Order Received üßæ

Order ID: ${result.order_id}
Name: ${name}
Phone: ${phone}

Items:
${itemsText}
`.trim();

    // 3Ô∏è‚É£ YOUR WhatsApp number (CHANGE THIS)
    const YOUR_WHATSAPP_NUMBER = "919978120889";

    const whatsappURL =
      `https://wa.me/${YOUR_WHATSAPP_NUMBER}?text=` +
      encodeURIComponent(message);

    // 4Ô∏è‚É£ Open WhatsApp
    window.open(whatsappURL, "_blank");

    // 5Ô∏è‚É£ Reset UI
    cart = [];
    document.getElementById("cartCount").innerText = 0;
    closeUserModal();

  } catch (err) {
    console.error(err);
    alert("Failed to place order");
  }
}


 
// ‚¨áÔ∏è THESE MUST BE OUTSIDE FUNCTIONS
document.getElementById("cartBtn").onclick = openCart;
backBtn.onclick = showCategories;
if (document.getElementById("categoryGrid")) {
  loadProducts();
}
</script>
</body>
</html>
