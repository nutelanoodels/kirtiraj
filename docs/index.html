<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Category Grid</title>
 <style>
/* ===== GLOBAL ===== */
html, body {
  margin: 0;
  padding: 0;
  font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
  background: #faf7f2;
  color: #222;
}

.page-wrap {
  max-width: 1200px;
  margin: auto;
  padding: 0 16px;
}

/* ===== HEADER ===== */
.site-header {
  position: sticky;
  top: 0;
  background: #ffffff;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 18px;
  box-shadow: 0 4px 14px rgba(0,0,0,0.08);
  z-index: 1000;
}

.logo {
  height: 48px;
}

.header-nav a {
  margin: 0 10px;
  text-decoration: none;
  font-weight: 600;
  color: #444;
}

.header-nav a:hover {
  color: #15803d;
}

.header-right button {
  background: #16a34a;
  color: #fff;
  border: none;
  padding: 8px 14px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
}

/* ===== SHOP SECTION ===== */
.shop-section {
  padding: 48px 0 32px;
}

.section-title {
  text-align: center;
  font-size: 2rem;
  font-weight: 800;
  margin-bottom: 8px;
}

.section-title::after {
  content: "Fresh ‚Ä¢ Handmade ‚Ä¢ Traditional";
  display: block;
  font-size: 0.9rem;
  font-weight: 500;
  color: #777;
  margin-top: 6px;
}

/* ===== GRID ===== */
.grid {
  display: grid;
  gap: 22px;
  margin-top: 32px;
}

/* Categories */
.grid.category-view {
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
}

/* Items */
.grid.item-view {
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

/* ===== CATEGORY CARD ===== */
.grid-item.category {
  background: linear-gradient(145deg, #fff7ed, #ffffff);
  border: 2px solid #fde68a;
  border-radius: 18px;
  padding: 28px 16px;
  text-align: center;
  font-size: 1.2rem;
  font-weight: 700;
  cursor: pointer;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  box-shadow: 0 8px 20px rgba(0,0,0,0.06);
}

.grid-item.category:hover {
  transform: translateY(-6px);
  box-shadow: 0 16px 30px rgba(0,0,0,0.12);
}

/* ===== ITEM CARD ===== */
.grid-item.item {
  background: #ffffff;
  border-radius: 16px;
  padding: 14px;
  text-align: center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.grid-item.item:hover {
  transform: translateY(-4px);
  box-shadow: 0 14px 28px rgba(0,0,0,0.12);
}

.grid-item.item img {
  width: 120px;
  height: 120px;
  object-fit: contain;
  margin-bottom: 10px;
}

.grid-item.item div:first-of-type {
  font-weight: 700;
  font-size: 0.95rem;
  margin-bottom: 4px;
}

.grid-item.item div:last-of-type {
  font-size: 0.9rem;
  color: #15803d;
  font-weight: 600;
}

/* ===== BACK BUTTON ===== */
.back-btn {
  display: inline-block;
  margin: 10px 0;
  background: #15803d;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
}

/* ===== MODALS ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal-box {
  background: white;
  width: 320px;
  padding: 20px;
  border-radius: 16px;
  text-align: center;
}

.modal-box img {
  width: 140px;
  height: 140px;
  object-fit: contain;
}

.buy-btn {
  background: #16a34a;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
}

.buy-btn:hover {
  background: #15803d;
}

/* ===== MOBILE ===== */
@media (max-width: 600px) {
  .section-title {
    font-size: 1.6rem;
  }

  .grid.category-view {
    grid-template-columns: 1fr 1fr;
  }

  .grid-item.category {
    font-size: 1rem;
    padding: 20px 12px;
  }

  .grid-item.item img {
    width: 100px;
    height: 100px;
  }
}
</style>
</head>
<body>
  <header class="site-header">
  <div class="header-left">
    <img src="logo2.png" alt="Kirtiraj Logo" class="logo" />
  </div>

  <nav class="header-nav">
   <a href="#categories">Shop</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>

  <div class="header-right">
    <button id="cartBtn">
      üõí Cart (<span id="cartCount">0</span>)
    </button>
  </div>
</header>
<main class="page-wrap">
  <section id="categories" class="shop-section">
  <h2 class="section-title">Shop Our Products</h2>

  <button class="back-btn" id="backBtn" style="display:none;">
    ‚Üê Back to Categories
  </button>

  <div class="grid" id="categoryGrid"></div>
</section>
</main>
  

  
<div id="productModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <img id="modalImg">
    <h3 id="modalName"></h3>
    <p id="modalPrice"></p>

    <div class="qty">
      <button onclick="changeQty(-1)">‚àí</button>
      <span id="modalQty">1</span>
      <button onclick="changeQty(1)">+</button>
    </div>

    <button onclick="addToCart()">Add to Cart</button>
  </div>
</div>
  <div id="cartModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeCart()">‚úñ</span>
    <h3>Your Cart</h3>
    <div id="cartItems" class="cart-items"></div>
    <hr>
    <div class="cart-footer">
  <strong>Total: ‚Çπ<span id="cartTotal">0</span></strong>
 <button class="buy-btn" onclick="openUserModal()">Buy Now</button>
  </div>
  </div>
</div>
<div id="userModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeUserModal()">‚úñ</span>
    <h3>Enter Your Details</h3>

    <input id="userName" type="text" placeholder="Your Name" style="width:100%;margin-bottom:10px;padding:8px;">
    <input id="userPhone" type="tel" placeholder="whatsapp Number" style="width:100%;margin-bottom:10px;padding:8px;">
    <textarea id="userAddress" placeholder="Address" style="width:100%;margin-bottom:10px;padding:8px;"></textarea>

    <button class="buy-btn" onclick="confirmOrder()">Confirm Order</button>
  </div>
</div>
<section class="about-section">
  <div class="about-box">
    <h2>About Kirtiraj</h2>

    <p>
      Kirtiraj is a family-run snacks and namkeen brand known for its
      authentic taste and traditional recipes. Every item is prepared
      with care, quality ingredients, and the same flavors that have
      been loved for generations.
    </p>

    <div class="about-highlights">
      <div class="about-card">
        <strong>üçò Traditional Recipes</strong>
        Made using time-tested methods for authentic taste.
      </div>

      <div class="about-card">
        <strong>üåø Quality Ingredients</strong>
        Fresh, hygienic, and carefully selected raw materials.
      </div>

      <div class="about-card">
        <strong>üè† Homely Taste</strong>
        Snacks that feel homemade and comforting.
      </div>

      <div class="about-card">
        <strong>üì¶ Fresh Orders</strong>
        Prepared and packed with care for every customer.
      </div>
    </div>
  </div>
</section>
<section class="contact-section">
  <div class="contact-box">
    <h2>Contact Us</h2>

    <div class="contact-grid">
      <div class="contact-card">
        <strong>üìû Phone</strong>
        +91 99781 20889
      </div>

      <div class="contact-card">
        <strong>üí¨ WhatsApp</strong>
        <a href="https://wa.me/919978120889" target="_blank">
          Chat on WhatsApp
        </a>
      </div>

      <div class="contact-card">
        <strong>üìç Location</strong>
        <a href="https://share.google/bPcfSi6NEEffhx70W" target="_blank">
          View on Google Maps
        </a>
      </div>
    </div>
  </div>
</section>
<script>
    const API_BASE = "https://kirtiraj.onrender.com";
let data = {};

const categoryGrid = document.getElementById("categoryGrid");
const backBtn = document.getElementById("backBtn");

let cart = [];
let selectedItem = null;
let quantity = 1;
function openModal(item) {
  selectedItem = item;
  quantity = 1;

  document.getElementById("modalImg").src = item.img || "";
  document.getElementById("modalName").innerText = item.name;
  document.getElementById("modalPrice").innerText =
    item.rate ? `‚Çπ${item.rate}` : "Price unavailable";
  document.getElementById("modalQty").innerText = quantity;

  document.getElementById("productModal").classList.remove("hidden");
}
  

function closeModal() {
  document.getElementById("productModal").classList.add("hidden");
}

function changeQty(val) {
  quantity = Math.max(1, quantity + val);
  document.getElementById("modalQty").innerText = quantity;
}

function addToCart() {
  cart.push({
    name: selectedItem.name,
    rate: selectedItem.rate || 0,
    img: selectedItem.img || "",
    quantity
  });

  document.getElementById("cartCount").innerText = cart.length;
  closeModal();
}
async function loadProducts() {
  try {
    const response = await fetch(`${API_BASE}/api/products/`);
    const products = await response.json();

    data = {};

    products.forEach(p => {
      const category = p.category || "Others";

      if (!data[category]) {
        data[category] = [];
      }

     data[category].push({
    name: p.name,
    rate: p.price,
    img: p.image || ""
      });
    });

    showCategories();
  } catch (error) {
    console.error(error);
    alert("Failed to load products from backend");
  }
}
function showCategories() {
  categoryGrid.className = "grid category-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "none";
  if (Object.keys(data).length === 0) {
  categoryGrid.innerHTML = "<p style='text-align:center'>No products available.</p>";
}
  Object.keys(data).forEach(category => {
    const div = document.createElement("div");
    div.className = "grid-item category";
    div.textContent = category;
    div.onclick = () => showItems(category);
    categoryGrid.appendChild(div);
  });
}

function showItems(category) {
  categoryGrid.className = "grid item-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "inline";
  const items = data[category] || [];

  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "grid-item item";
    div.onclick = () => openModal(item);

    if (item.img) {
      const img = document.createElement("img");
      img.src = item.img.trim();
      img.alt = item.name;
      img.style.width = "100px";
      img.style.height = "100px";
      img.style.objectFit = "contain";
      div.appendChild(img);
    }

    const name = document.createElement("div");
    name.textContent = item.name;
    name.style.fontWeight = "bold";
    name.style.margin = "8px 0";
    name.style.textAlign = "center";

    const rate = document.createElement("div");
    rate.textContent = item.rate ? `‚Çπ${item.rate}` : "Rate Unavailable";

    div.appendChild(name);
    div.appendChild(rate);
    categoryGrid.appendChild(div);
  });
}
function openCart() {
  renderCart();
  document.getElementById("cartModal").classList.remove("hidden");
}

function closeCart() {
  document.getElementById("cartModal").classList.add("hidden");
}

function renderCart() {
  const cartItemsDiv = document.getElementById("cartItems");
  cartItemsDiv.innerHTML = "";

  let total = 0;

  if (cart.length === 0) {
    cartItemsDiv.innerText = "Your cart is empty.";
    document.getElementById("cartTotal").innerText = 0;
    return;
  }

  cart.forEach((item, index) => {
    const itemRow = document.createElement("div");
    itemRow.className = "cart-item";

    // Image
    const img = document.createElement("img");
    img.src = item.img || "";
    img.alt = item.name;

    // Info
    const info = document.createElement("div");
    info.className = "cart-info";

    const name = document.createElement("strong");
    name.textContent = item.name;

    const price = document.createElement("div");
    price.textContent = `‚Çπ${item.rate || 0} √ó ${item.quantity}`;

    info.appendChild(name);
    info.appendChild(price);

    // Actions
    const actions = document.createElement("div");
    actions.className = "cart-actions";

    const minus = document.createElement("button");
    minus.textContent = "‚àí";
    minus.onclick = () => updateQty(index, -1);

    const qty = document.createElement("span");
    qty.textContent = item.quantity;

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.onclick = () => updateQty(index, 1);

    const subtotal = document.createElement("div");
    const itemTotal = (item.rate || 0) * item.quantity;
    subtotal.textContent = `‚Çπ${itemTotal}`;
    total += itemTotal;

    const remove = document.createElement("button");
    remove.textContent = "Remove";
    remove.onclick = () => removeItem(index);

    actions.appendChild(minus);
    actions.appendChild(qty);
    actions.appendChild(plus);
    actions.appendChild(subtotal);
    actions.appendChild(remove);

    itemRow.appendChild(img);
    itemRow.appendChild(info);
    itemRow.appendChild(actions);

    cartItemsDiv.appendChild(itemRow);
  });

  document.getElementById("cartTotal").innerText = total;
}

function updateQty(index, change) {
  cart[index].quantity += change;

  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  }

  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}
function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }

  // OPTIONAL: log order
  console.log("Order placed:", cart);

  // Clear cart
  cart = [];

  // Reset UI
  document.getElementById("cartCount").innerText = 0;
  renderCart();
  closeCart();

  alert("Order placed successfully!");
}
function openUserModal() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }
  closeCart();
  document.getElementById("userModal").classList.remove("hidden");
}

function closeUserModal() {
  document.getElementById("userModal").classList.add("hidden");
}
async function confirmOrder() {
  const name = document.getElementById("userName").value.trim();
  const phone = document.getElementById("userPhone").value.trim();
  const address = document.getElementById("userAddress").value.trim();

  if (!name || !phone || !address) {
    alert("Please fill all details.");
    return;
  }

  if (cart.length === 0) {
    alert("Cart is empty.");
    return;
  }

  try {
    // 1Ô∏è‚É£ Save order in backend
    const response = await fetch(`${API_BASE}/api/orders/create/`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name,
        phone,
        address,
        items: cart, // backend already expects this
      }),
    });

    const result = await response.json();

    if (!result.success) {
      throw new Error("Order failed");
    }

    // 2Ô∏è‚É£ Build WhatsApp message (NO PRICE)
    const itemsText = cart
      .map(item => `‚Ä¢ ${item.name} √ó ${item.quantity}`)
      .join("\n");

    const message = `
New Order Received üßæ

Order ID: ${result.order_id}
Name: ${name}
Phone: ${phone}

Items:
${itemsText}
`.trim();

    // 3Ô∏è‚É£ YOUR WhatsApp number (CHANGE THIS)
    const YOUR_WHATSAPP_NUMBER = "919978120889";

    const whatsappURL =
      `https://wa.me/${YOUR_WHATSAPP_NUMBER}?text=` +
      encodeURIComponent(message);

    // 4Ô∏è‚É£ Open WhatsApp
    window.open(whatsappURL, "_blank");

    // 5Ô∏è‚É£ Reset UI
    cart = [];
    document.getElementById("cartCount").innerText = 0;
    closeUserModal();

  } catch (err) {
    console.error(err);
    alert("Failed to place order");
  }
}


 
// ‚¨áÔ∏è THESE MUST BE OUTSIDE FUNCTIONS
document.getElementById("cartBtn").onclick = openCart;
backBtn.onclick = showCategories;
if (document.getElementById("categoryGrid")) {
  loadProducts();
}
</script>
</body>
</html>
