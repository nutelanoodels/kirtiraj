<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Category Grid</title>
<style>
/* ===== THEME VARIABLES ===== */
:root {
  --navy: #0b1c2d;
  --navy-dark: #071423;
  --blue: #2563eb;
  --blue-soft: #3b82f6;
  --bg-light: #f5f7fb;
  --card-bg: #ffffff;
  --text-dark: #0f172a;
  --text-muted: #475569;
}

/* ===== GLOBAL SAFETY ===== */
* {
  box-sizing: border-box;
}

img {
  max-width: 100%;
  height: auto;
  display: block;
}

/* ===== BACKGROUND ===== */
body {
  margin: 0;
  font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
  background: linear-gradient(120deg, #0b1c2d, #0f2a44, #0b1c2d);
  background-size: 300% 300%;
  animation: bgMove 18s ease infinite;
  color: var(--text-dark);
  overflow-x: hidden;
}

@keyframes bgMove {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.page-wrap {
  max-width: 1200px;
  margin: auto;
  padding: 0 16px;
}

/* ===== HEADER ===== */
.site-header {
  position: sticky;
  top: 0;
  background: linear-gradient(180deg, #020617, #020617cc);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 28px;
  box-shadow: 0 6px 20px rgba(0,0,0,0.4);
  z-index: 1000;
}

.logo {
  height: 64px;
}

/* NAV */
.header-nav a {
  margin: 0 14px;
  text-decoration: none;
  font-weight: 600;
  color: #e5e7eb;
}

.header-nav a:hover {
  color: #60a5fa;
}

/* CART */
.header-right button {
  background: linear-gradient(135deg, #2563eb, #1e40af);
  color: #fff;
  border: none;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 600;
  cursor: pointer;
}

/* ===== SHOP SECTION ===== */
.shop-section {
  margin: 80px auto;
  padding: 80px 28px;
  background: rgba(255,255,255,0.95);
  border-radius: 28px;
  box-shadow: 0 40px 80px rgba(0,0,0,0.25);
}

.section-title {
  text-align: center;
  font-size: 2.6rem;
  font-weight: 900;
  color: var(--navy);
}

.section-title::after {
  content: "Fresh ‚Ä¢ Handmade ‚Ä¢ Trusted";
  display: block;
  margin-top: 10px;
  font-size: 1rem;
  color: var(--text-muted);
}

/* ===== GRID ===== */
.grid {
  display: grid;
  gap: 24px;
  margin-top: 40px;
}

.grid.category-view {
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
}

.grid.item-view {
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

/* ===== CATEGORY CARDS ===== */
.grid-item.category {
  height: 180px;
  background: linear-gradient(145deg, #f8fafc, #e2e8f0);
  border-radius: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: 800;
  color: var(--navy);
  cursor: pointer;
  transition: all 0.35s ease;
  box-shadow: 0 18px 40px rgba(0,0,0,0.12);
}

.grid-item.category:hover {
  transform: translateY(-12px);
  background: linear-gradient(145deg, var(--blue), var(--blue-soft));
  color: white;
}

/* ===== ITEM CARD ===== */
.grid-item.item {
  background: var(--card-bg);
  border-radius: 18px;
  padding: 16px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.1);
  transition: all 0.25s ease;
  overflow: hidden;
}

.grid-item.item:hover {
  transform: translateY(-6px);
  box-shadow: 0 20px 45px rgba(0,0,0,0.18);
}

.grid-item.item img {
  width: 100%;
  max-width: 140px;
  aspect-ratio: 1 / 1;
  object-fit: contain;
  margin: 0 auto 10px;
}

.grid-item.item div:first-of-type {
  font-weight: 700;
  font-size: 0.95rem;
  color: var(--text-dark);
}

.grid-item.item div:last-of-type {
  font-size: 0.9rem;
  color: var(--blue);
  font-weight: 700;
}

/* ===== BUTTONS ===== */
.back-btn,
.buy-btn {
  background: var(--blue);
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 999px;
  font-weight: 700;
  cursor: pointer;
}

.back-btn:hover,
.buy-btn:hover {
  background: var(--blue-soft);
}

/* ===== MODALS ===== */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

.modal-box {
  background: white;
  width: 340px;
  max-height: 90vh;
  overflow-y: auto;
  padding: 24px;
  border-radius: 20px;
  text-align: center;
}

.modal-box img {
  width: 100%;
  max-width: 220px;
  max-height: 40vh;
  object-fit: contain;
  margin: 0 auto 12px;
}

.hidden {
  display: none !important;
}

/* ===== ABOUT ===== */
.about-section {
  padding: 100px 24px;
}

.about-box {
  max-width: 900px;
  margin: auto;
  background: white;
  border-radius: 28px;
  padding: 50px 40px;
  text-align: center;
  box-shadow: 0 30px 70px rgba(0,0,0,0.2);
}

.about-box h2 {
  color: var(--navy);
  font-size: 2.3rem;
}

.about-box p {
  color: var(--text-muted);
  line-height: 1.7;
}

/* ===== CONTACT ===== */
.contact-section {
  padding: 100px 24px;
}

.contact-box h2 {
  color: white;
  font-size: 2.4rem;
}

/* ===== MOBILE FIXES ===== */
@media (max-width: 600px) {

  .site-header {
    flex-direction: column;
    gap: 12px;
    padding: 16px;
  }

  .logo {
    height: 56px;
  }

  .header-nav {
    display: flex;
    gap: 20px;
  }

  .grid.category-view,
  .grid.item-view {
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
  }

  .section-title {
    font-size: 1.6rem;
  }
}
/* ===============================
   MOBILE CATEGORY GRID FIX (FINAL)
   =============================== */
@media (max-width: 768px) {

  /* FORCE GRID TO RESPECT SCREEN */
  .grid.category-view {
    display: grid;
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 12px;
    width: 100%;
    max-width: 100%;
  }

  .grid-item.category {
    width: 100%;
    height: 110px;
    font-size: 0.95rem;
    padding: 10px;
    border-radius: 16px;
    box-sizing: border-box;
  }
}

</style>
</head>
<body>
  <header class="site-header">
  <div class="header-left">
    <img src="logo3.webp" alt="Kirtiraj Logo" class="logo" />
  </div>

  <nav class="header-nav">
   <a href="#categories">Shop</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
  </nav>

  <div class="header-right">
    <button id="cartBtn">
      üõí Cart (<span id="cartCount">0</span>)
    </button>
  </div>
</header>
<main class="page-wrap">
  <section id="categories" class="shop-section">
  <h2 class="section-title">Shop Our Products</h2>

  <button class="back-btn" id="backBtn" style="display:none;">
    ‚Üê Back to Categories
  </button>

  <div class="grid" id="categoryGrid"></div>
</section>
</main>
  

  
<div id="productModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úñ</span>
    <img id="modalImg">
    <h3 id="modalName"></h3>
    <p id="modalPrice"></p>

    <div class="qty">
      <button onclick="changeQty(-1)">‚àí</button>
      <span id="modalQty">1</span>
      <button onclick="changeQty(1)">+</button>
    </div>

    <button onclick="addToCart()">Add to Cart</button>
  </div>
</div>
  <div id="cartModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeCart()">‚úñ</span>
    <h3>Your Cart</h3>
    <div id="cartItems" class="cart-items"></div>
    <hr>
    <div class="cart-footer">
  <strong>Total: ‚Çπ<span id="cartTotal">0</span></strong>
 <button class="buy-btn" onclick="openUserModal()">Buy Now</button>
  </div>
  </div>
</div>
<div id="userModal" class="modal hidden">
  <div class="modal-box">
    <span class="close" onclick="closeUserModal()">‚úñ</span>
    <h3>Enter Your Details</h3>

    <input id="userName" type="text" placeholder="Your Name" style="width:100%;margin-bottom:10px;padding:8px;">
    <input id="userPhone" type="tel" placeholder="whatsapp Number" style="width:100%;margin-bottom:10px;padding:8px;">
    <textarea id="userAddress" placeholder="Address" style="width:100%;margin-bottom:10px;padding:8px;"></textarea>

    <button class="buy-btn" onclick="confirmOrder()">Confirm Order</button>
  </div>
</div>
<section class="about-section">
  <div class="about-box">
    <h2>About Kirtiraj</h2>

    <p>
      Kirtiraj is a family-run snacks and namkeen brand known for its
      authentic taste and traditional recipes. Every item is prepared
      with care, quality ingredients, and the same flavors that have
      been loved for generations.
    </p>

    <div class="about-highlights">
      <div class="about-card">
  <strong>Traditional Recipes</strong>
  Made using time-tested methods for authentic taste.
</div>

<div class="about-card">
  <strong>Quality Ingredients</strong>
  Fresh, hygienic, and carefully selected raw materials.
</div>

<div class="about-card">
  <strong>Homely Taste</strong>
  Snacks that feel homemade and comforting.
</div>

<div class="about-card">
  <strong>Fresh Orders</strong>
  Prepared and packed with care for every customer.
</div>
    </div>
  </div>
</section>
<section class="contact-section">
  <div class="contact-box">
    <h2>Contact Us</h2>

    <div class="contact-grid">
      <div class="contact-card">
        <strong>üìû Phone</strong>
        +91 99781 20889
      </div>

      <div class="contact-card">
        <strong>üí¨ WhatsApp</strong>
        <a href="https://wa.me/919978120889" target="_blank">
          Chat on WhatsApp
        </a>
      </div>

      <div class="contact-card">
        <strong>üìç Location</strong>
        <a href="https://share.google/bPcfSi6NEEffhx70W" target="_blank">
          View on Google Maps
        </a>
      </div>
    </div>
  </div>
</section>
<script>
    const API_BASE = "https://kirtiraj.onrender.com";
let data = {};

const categoryGrid = document.getElementById("categoryGrid");
const backBtn = document.getElementById("backBtn");

let cart = [];
let selectedItem = null;
let quantity = 1;
function openModal(item) {
  selectedItem = item;
  quantity = 1;

  document.getElementById("modalImg").src = item.img || "";
  document.getElementById("modalName").innerText = item.name;
  document.getElementById("modalPrice").innerText =
    item.rate ? `‚Çπ${item.rate}` : "Price unavailable";
  document.getElementById("modalQty").innerText = quantity;

  document.getElementById("productModal").classList.remove("hidden");
}
  

function closeModal() {
  document.getElementById("productModal").classList.add("hidden");
}

function changeQty(val) {
  quantity = Math.max(1, quantity + val);
  document.getElementById("modalQty").innerText = quantity;
}

function addToCart() {
  cart.push({
    name: selectedItem.name,
    rate: selectedItem.rate || 0,
    img: selectedItem.img || "",
    quantity
  });

  document.getElementById("cartCount").innerText = cart.length;
  closeModal();
}
async function loadProducts() {
  try {
    const response = await fetch(`${API_BASE}/api/products/`);
    const products = await response.json();

    data = {};

    products.forEach(p => {
      const category = p.category || "Others";

      if (!data[category]) {
        data[category] = [];
      }

     data[category].push({
    name: p.name,
    rate: p.price,
    img: p.image || ""
      });
    });

    showCategories();
  } catch (error) {
    console.error(error);
    alert("Failed to load products from backend");
  }
}
function showCategories() {
  categoryGrid.className = "grid category-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "none";
  if (Object.keys(data).length === 0) {
  categoryGrid.innerHTML = "<p style='text-align:center'>No products available.</p>";
}
  Object.keys(data).forEach(category => {
    const div = document.createElement("div");
    div.className = "grid-item category";
    div.textContent = category;
    div.onclick = () => showItems(category);
    categoryGrid.appendChild(div);
  });
}

function showItems(category) {
  categoryGrid.className = "grid item-view";
  categoryGrid.innerHTML = "";
  backBtn.style.display = "inline";
  const items = data[category] || [];

  items.forEach(item => {
    const div = document.createElement("div");
    div.className = "grid-item item";
    div.onclick = () => openModal(item);

    if (item.img) {
      const img = document.createElement("img");
      img.src = item.img.trim();
      img.alt = item.name;
      img.style.width = "100px";
      img.style.height = "100px";
      img.style.objectFit = "contain";
      div.appendChild(img);
    }

    const name = document.createElement("div");
    name.textContent = item.name;
    name.style.fontWeight = "bold";
    name.style.margin = "8px 0";
    name.style.textAlign = "center";

    const rate = document.createElement("div");
    rate.textContent = item.rate ? `‚Çπ${item.rate}` : "Rate Unavailable";

    div.appendChild(name);
    div.appendChild(rate);
    categoryGrid.appendChild(div);
  });
}
function openCart() {
  renderCart();
  document.getElementById("cartModal").classList.remove("hidden");
}

function closeCart() {
  document.getElementById("cartModal").classList.add("hidden");
}

function renderCart() {
  const cartItemsDiv = document.getElementById("cartItems");
  cartItemsDiv.innerHTML = "";

  let total = 0;

  if (cart.length === 0) {
    cartItemsDiv.innerText = "Your cart is empty.";
    document.getElementById("cartTotal").innerText = 0;
    return;
  }

  cart.forEach((item, index) => {
    const itemRow = document.createElement("div");
    itemRow.className = "cart-item";

    // Image
    const img = document.createElement("img");
    img.src = item.img || "";
    img.alt = item.name;

    // Info
    const info = document.createElement("div");
    info.className = "cart-info";

    const name = document.createElement("strong");
    name.textContent = item.name;

    const price = document.createElement("div");
    price.textContent = `‚Çπ${item.rate || 0} √ó ${item.quantity}`;

    info.appendChild(name);
    info.appendChild(price);

    // Actions
    const actions = document.createElement("div");
    actions.className = "cart-actions";

    const minus = document.createElement("button");
    minus.textContent = "‚àí";
    minus.onclick = () => updateQty(index, -1);

    const qty = document.createElement("span");
    qty.textContent = item.quantity;

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.onclick = () => updateQty(index, 1);

    const subtotal = document.createElement("div");
    const itemTotal = (item.rate || 0) * item.quantity;
    subtotal.textContent = `‚Çπ${itemTotal}`;
    total += itemTotal;

    const remove = document.createElement("button");
    remove.textContent = "Remove";
    remove.onclick = () => removeItem(index);

    actions.appendChild(minus);
    actions.appendChild(qty);
    actions.appendChild(plus);
    actions.appendChild(subtotal);
    actions.appendChild(remove);

    itemRow.appendChild(img);
    itemRow.appendChild(info);
    itemRow.appendChild(actions);

    cartItemsDiv.appendChild(itemRow);
  });

  document.getElementById("cartTotal").innerText = total;
}

function updateQty(index, change) {
  cart[index].quantity += change;

  if (cart[index].quantity <= 0) {
    cart.splice(index, 1);
  }

  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}

function removeItem(index) {
  cart.splice(index, 1);
  document.getElementById("cartCount").innerText = cart.length;
  renderCart();
}
function checkout() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }

  // OPTIONAL: log order
  console.log("Order placed:", cart);

  // Clear cart
  cart = [];

  // Reset UI
  document.getElementById("cartCount").innerText = 0;
  renderCart();
  closeCart();

  alert("Order placed successfully!");
}
function openUserModal() {
  if (cart.length === 0) {
    alert("Your cart is empty.");
    return;
  }
  closeCart();
  document.getElementById("userModal").classList.remove("hidden");
}

function closeUserModal() {
  document.getElementById("userModal").classList.add("hidden");
}
async function confirmOrder() {
  const name = document.getElementById("userName").value.trim();
  const phone = document.getElementById("userPhone").value.trim();
  const address = document.getElementById("userAddress").value.trim();

  if (!name || !phone || !address) {
    alert("Please fill all details.");
    return;
  }

  if (cart.length === 0) {
    alert("Cart is empty.");
    return;
  }

  try {
    // 1Ô∏è‚É£ Save order in backend
    const response = await fetch(`${API_BASE}/api/orders/create/`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    name,
    phone,
    address,
    items: cart.map(item => ({
      name: item.name,
      quantity: item.quantity
    }))
  }),
});

const result = await response.json();

if (!response.ok) {
  console.error("Backend error:", result);
  alert(result.detail || "Failed to place order");
  return;
}

    // 2Ô∏è‚É£ Build WhatsApp message (NO PRICE)
    const itemsText = cart
      .map(item => `‚Ä¢ ${item.name} √ó ${item.quantity}`)
      .join("\n");

    const message = `
New Order Received üßæ

Order ID: ${result.order_id}
Name: ${name}
Phone: ${phone}

Items:
${itemsText}
`.trim();

    // 3Ô∏è‚É£ YOUR WhatsApp number (CHANGE THIS)
    const YOUR_WHATSAPP_NUMBER = "919978120889";

    const whatsappURL =
      `https://wa.me/${YOUR_WHATSAPP_NUMBER}?text=` +
      encodeURIComponent(message);

    // 4Ô∏è‚É£ Open WhatsApp
    window.open(whatsappURL, "_blank");

    // 5Ô∏è‚É£ Reset UI
    cart = [];
    document.getElementById("cartCount").innerText = 0;
    closeUserModal();

  } catch (err) {
    console.error(err);
    alert("Failed to place order");
  }
}


 
// ‚¨áÔ∏è THESE MUST BE OUTSIDE FUNCTIONS
document.getElementById("cartBtn").onclick = openCart;
backBtn.onclick = showCategories;
if (document.getElementById("categoryGrid")) {
  loadProducts();
}
</script>
</body>
</html>
